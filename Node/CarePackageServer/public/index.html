<html>

<head>
    <style>
        html {
            height: 100%;
            width: 100%;
            overflow: hidden;
        }

        body {
            height: 100%;
            padding: 0;
            overflow: auto;
            margin: 0;
            -webkit-overflow-scrolling: touch;
        }
    </style>

    <meta name="viewport" content="width=device-width, initial-scale=1">
</head>

<body>

    <canvas id="canvas" width="375" height="375"></canvas>
    <button id="submit">Submit</button>

    <script>
        (function () {

            // window.addEventListener("touchstart", function (event) {
            //     event.preventDefault();
            // }, { passive: false });

            window.addEventListener("touchmove", function (event) {
                event.preventDefault();
            }, { passive: false });


            //


            var submitButton = document.getElementById("submit");
            submitButton.addEventListener("click", function () {

                var canvasImage = document.getElementById("canvas");
                var img = canvasImage.toDataURL("image/png");
                var filename = 'Texture_0.jpg';
                //console.log(img);
                //console.log(filename);

                //

                let formData = new FormData();

                formData.append("filename", filename);
                formData.append("file", img);

                fetch('/upload', { method: "POST", body: formData });

            }, false);

            //

            let drawing = false;

            var canvas = document.getElementById("canvas");
            var canvasContext = canvas.getContext("2d");

            canvas.addEventListener("mousemove", function (e) {
                if (drawing) {

                    let x = e.clientX - canvas.offsetLeft;
                    let y = e.clientY - canvas.offsetTop;

                    console.log(x, y);

                    canvasContext.beginPath();
                    canvasContext.arc(x, y, 8, 0, 2 * Math.PI);
                    canvasContext.fillStyle = "red";
                    canvasContext.fill();

                }
            }, false);

            canvas.addEventListener("touchmove", function (e) {
                if (drawing) {

                    let x = e.touches[0].clientX - canvas.offsetLeft;
                    let y = e.touches[0].clientY - canvas.offsetTop;

                    console.log(x, y);

                    canvasContext.beginPath();
                    canvasContext.arc(x, y, 8, 0, 2 * Math.PI);
                    canvasContext.fillStyle = "red";
                    canvasContext.fill();

                }
            }, false);

            canvas.addEventListener("mousedown", function (e) {
                drawing = true;
            }, false);

            canvas.addEventListener("mouseup", function (e) {
                drawing = false;
            }, false);

            canvas.addEventListener("touchstart", function (e) {
                drawing = true;
            }, false);

            canvas.addEventListener("touchend", function (e) {
                drawing = false;
            }, false);

        })();

    </script>

</body>

</html>